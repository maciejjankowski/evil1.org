---
# Consumer Evil Assessment Test Component
# Interactive quiz to help consumers maximize their support for corporate evil
---

{%- assign component = include.component -%}
{%- assign questions = component.questions | default: site.data.evil_assessment_questions -%}
{%- assign class = component.class | default: "" -%}
{%- assign title = component.title | default: "Consumer Evil Impact Assessment" -%}
{%- assign description = component.description | default: "Discover how to maximize the harm of your purchasing decisions. Because why support ethical companies when you can fund systematic oppression?" -%}

<div class="evil-assessment {{ class }}" id="evil-assessment">
  <div class="assessment-header">
    <h2>🔥 {{ title }}</h2>
    <p class="assessment-description">{{ description }}</p>
  </div>

  <form class="assessment-form" id="assessment-form">
    <div class="questions-container" id="questions-container">
      {% for question in questions %}
      <div class="question-card" data-question="{{ forloop.index }}">
        <h3 class="question-title">
          <span class="question-number">{{ forloop.index }}.</span>
          {{ question.text }}
        </h3>
        
        <div class="options-container">
          {% for option in question.options %}
          <label class="option-label">
            <input type="radio" 
                   name="question-{{ forloop.parentloop.index }}" 
                   value="{{ option.evil_score }}"
                   data-corporate="{{ option.corporate_beneficiary | default: 'Various Corporations' }}"
                   class="option-input">
            <span class="option-text">{{ option.text }}</span>
            <span class="evil-indicator">💀 {{ option.evil_score }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="assessment-actions">
      <button type="button" 
              class="btn btn-primary calculate-evil" 
              onclick="calculateEvilScore()"
              disabled>
        Calculate Your Evil Impact 🔥
      </button>
    </div>
  </form>

  <div class="results-container" id="results-container" style="display: none;">
    <div class="evil-score-display">
      <h3>🎯 Your Corporate Evil Support Score</h3>
      <div class="score-circle">
        <span class="score-number" id="total-score">0</span>
        <span class="score-label">Evil Points</span>
      </div>
      
      <div class="score-interpretation" id="score-interpretation">
        <!-- Dynamic content based on score -->
      </div>
    </div>

    <div class="impact-breakdown">
      <h4>💰 Corporate Beneficiaries</h4>
      <div class="beneficiaries-list" id="beneficiaries-list">
        <!-- Dynamic list of corporations you're helping -->
      </div>
    </div>

    <div class="evil-recommendations">
      <h4>📈 Maximize Your Evil Impact</h4>
      <div class="recommendations-list" id="recommendations-list">
        <!-- Dynamic recommendations -->
      </div>
    </div>

    <!-- Monetization CTA Section -->
    <div class="monetization-cta">
      <h4>💰 Convert Your Evil Into Action</h4>
      <p>Ready to turn your consumer complicity into meaningful change? Support the journalism that exposes the very corporations you're accidentally funding!</p>
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <a href="/membership/" class="btn" style="background: #ffffff; color: #388E3C;">Join Our Resistance ($5/month)</a>
        <a href="/merchandise/" class="btn" style="background: #ffffff; color: #388E3C;">Buy Satirical Merch</a>
        <a href="/courses/" class="btn" style="background: #ffffff; color: #388E3C;">Learn Corporate Investigation</a>
      </div>
    </div>

    <div class="share-results">
      <h4>🌐 Spread the Evil (And The Awareness)</h4>
      <p style="margin-bottom: 20px; color: #cccccc;">Share your results to help others discover their complicity in corporate evil!</p>
      <button class="btn btn-secondary" onclick="shareResults()">
        Share Your Evil Score
      </button>
      <button class="btn btn-primary" onclick="resetAssessment()">
        Take Assessment Again
      </button>
      <div style="margin-top: 20px;">
        <a href="/newsletter/" class="btn btn-secondary">Get Weekly Evil Updates</a>
      </div>
    </div>
  </div>
</div>

<script>
let assessmentData = {
  answers: {},
  totalScore: 0,
  corporateBeneficiaries: {},
  questionCount: {{ questions.size | default: 0 }}
};

// Enable calculate button when all questions are answered
function checkFormComplete() {
  const totalQuestions = assessmentData.questionCount;
  const answeredQuestions = Object.keys(assessmentData.answers).length;
  const calculateBtn = document.querySelector('.calculate-evil');
  
  if (answeredQuestions === totalQuestions) {
    calculateBtn.disabled = false;
  } else {
    calculateBtn.disabled = true;
  }
}

// Handle radio button changes
document.addEventListener('change', function(e) {
  if (e.target.matches('.option-input')) {
    const questionNum = e.target.name.split('-')[1];
    const evilScore = parseInt(e.target.value);
    const corporate = e.target.dataset.corporate;
    
    // Store answer
    assessmentData.answers[questionNum] = {
      score: evilScore,
      corporate: corporate
    };
    
    // Update corporate beneficiaries count
    if (assessmentData.corporateBeneficiaries[corporate]) {
      assessmentData.corporateBeneficiaries[corporate] += evilScore;
    } else {
      assessmentData.corporateBeneficiaries[corporate] = evilScore;
    }
    
    checkFormComplete();
  }
});

function calculateEvilScore() {
  // Calculate total score
  let totalScore = 0;
  Object.values(assessmentData.answers).forEach(answer => {
    totalScore += answer.score;
  });
  
  assessmentData.totalScore = totalScore;
  
  // Show results
  document.getElementById('results-container').style.display = 'block';
  document.getElementById('total-score').textContent = totalScore;
  
  // Generate interpretation
  displayScoreInterpretation(totalScore);
  
  // Display corporate beneficiaries
  displayCorporateBeneficiaries();
  
  // Generate recommendations
  generateRecommendations(totalScore);
  
  // Scroll to results
  document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
}

function displayScoreInterpretation(score) {
  const interpretationEl = document.getElementById('score-interpretation');
  let interpretation = '';
  
  if (score >= 80) {
    interpretation = `
      <div class="score-level master-evil">
        <h5>🏆 Master of Corporate Evil</h5>
        <p>Congratulations! You're a true corporate enabler. Your purchasing decisions maximize shareholder value while minimizing human welfare. The 1% salutes your dedication to systematic oppression.</p>
      </div>
    `;
  } else if (score >= 60) {
    interpretation = `
      <div class="score-level experienced-evil">
        <h5>💼 Experienced Evil Enabler</h5>
        <p>Impressive! You've mastered the art of supporting corporate malfeasance. With a few tweaks, you could achieve true evil mastery. Consider upgrading to premium exploitation packages.</p>
      </div>
    `;
  } else if (score >= 40) {
    interpretation = `
      <div class="score-level moderate-evil">
        <h5>📊 Moderate Evil Contributor</h5>
        <p>You're on the right track to supporting corporate domination, but there's room for improvement. Consider embracing more destructive consumer choices for maximum societal harm.</p>
      </div>
    `;
  } else if (score >= 20) {
    interpretation = `
      <div class="score-level amateur-evil">
        <h5>🌱 Amateur Evil Supporter</h5>
        <p>You show promise in supporting corporate evil, but you're still too concerned with ethics. Embrace the dark side of capitalism - your wallet and the oligarchy will thank you.</p>
      </div>
    `;
  } else {
    interpretation = `
      <div class="score-level ethical-failure">
        <h5>😇 Ethical Failure</h5>
        <p>Oh no! You're practically a humanitarian. Your consumer choices actually support workers, communities, and the environment. This is highly inefficient for corporate profit extraction.</p>
      </div>
    `;
  }
  
  interpretationEl.innerHTML = interpretation;
}

function displayCorporateBeneficiaries() {
  const beneficiariesEl = document.getElementById('beneficiaries-list');
  const sorted = Object.entries(assessmentData.corporateBeneficiaries)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);
  
  let html = '<div class="beneficiaries-grid">';
  sorted.forEach(([company, score]) => {
    html += `
      <div class="beneficiary-item">
        <span class="company-name">${company}</span>
        <span class="evil-contribution">+${score} evil points</span>
      </div>
    `;
  });
  html += '</div>';
  
  beneficiariesEl.innerHTML = html;
}

function generateRecommendations(score) {
  const recommendationsEl = document.getElementById('recommendations-list');
  
  let recommendations = [];
  
  if (score >= 80) {
    recommendations = [
      "🏆 Congratulations! You're a certified evil enabler. Consider our Premium Evil Membership ($50/month) for exclusive corporate corruption insights!",
      "💼 Sign up for our 'Advanced Corporate Malfeasance' course ($299) to learn how to identify and expose the companies you're supporting",
      "🛒 Shop our 'Master of Evil' merchandise collection - wear your complicity with pride while funding investigative journalism",
      "📚 Buy our upcoming book 'The Evil Consumer's Guide to Corporate Domination' (pre-order for $29.99)"
    ];
  } else if (score >= 60) {
    recommendations = [
      "📈 You're almost there! Join our Standard Membership ($15/month) to learn how to maximize your evil impact",
      "🎯 Take our 'Intermediate Corporate Evil Detection' course ($199) to better understand your choices",
      "👕 Buy our 'Experienced Evil Enabler' t-shirt ($29.99) - perfect for corporate networking events",
      "📧 Subscribe to our premium newsletter ($5/month) for weekly evil corporation spotlights"
    ];
  } else if (score >= 40) {
    recommendations = [
      "🌱 You have potential! Start with our Basic Membership ($5/month) to learn the fundamentals of corporate evil",
      "📖 Get our starter guide 'Corporate Evil for Beginners' ($19.99) to improve your evil impact",
      "☕ Buy our 'Moderate Evil Contributor' mug ($19.99) - perfect for your morning coffee of complicity",
      "📱 Download our app ($2.99) to track your daily evil score in real-time"
    ];
  } else if (score >= 20) {
    recommendations = [
      "🎓 Take our free 'Introduction to Corporate Evil' course to understand how corporations exploit you",
      "🧢 Buy our 'Amateur Evil Supporter' hat ($24.99) to show you're learning the ropes",
      "📰 Subscribe to our free newsletter to start your journey into corporate awareness",
      "🎁 Gift a membership to a friend who scores higher - misery loves company!"
    ];
  } else {
    recommendations = [
      "😇 Oh dear! You're practically a saint. Buy our 'Ethical Failure' badge ($12.99) to wear your shame",
      "📚 URGENT: Read our guide 'How to Stop Being So Ethical' ($24.99) - your corporate overlords are disappointed",
      "🆘 Sign up for our 'Emergency Evil Training' program ($99) - learn to embrace your inner capitalist",
      "💡 Consider our consultation service ($150/hour) to personally assess how to increase your evil impact"
    ];
  }
  
  let html = '<ul class="recommendations-list">';
  recommendations.forEach(rec => {
    html += `<li class="recommendation-item">${rec}</li>`;
  });
  html += '</ul>';
  
  // Add satirical disclaimer
  html += `
    <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 6px; font-size: 0.9em; color: #cccccc; font-style: italic;">
      <strong>Disclaimer:</strong> By purchasing our products, you're contributing to the very capitalist system we're satirizing. 
      This is peak irony, and we're charging you for the privilege of experiencing it. Your money does fund actual investigative journalism though, so... you're welcome? 
      <br><br>
      <em>Terms and conditions apply. Side effects may include increased awareness, buyer's remorse, and an uncomfortable understanding of your role in systemic oppression.</em>
    </div>
  `;
  
  recommendationsEl.innerHTML = html;
}

function shareResults() {
  const score = assessmentData.totalScore;
  let shareText = `I scored ${score} evil points on the Corporate Evil Support Assessment! `;
  
  if (score >= 80) {
    shareText += "I'm officially a Master of Corporate Evil! 🏆 Shareholders everywhere are applauding my dedication to their profits.";
  } else if (score >= 60) {
    shareText += "I'm an Experienced Evil Enabler! 💼 My purchasing decisions are crushing workers and communities efficiently.";
  } else if (score >= 40) {
    shareText += "I'm a Moderate Evil Contributor! 📊 Still too ethical for maximum shareholder value, but improving.";
  } else if (score >= 20) {
    shareText += "I'm an Amateur Evil Supporter! 🌱 My heart's in the right place (for corporate profits).";
  } else {
    shareText += "I'm an Ethical Failure! 😇 My consumer choices actually help people instead of corporations. How embarrassing!";
  }
  
  shareText += ` Discover how your consumer choices fuel systematic oppression at ${window.location.href}`;
  
  // Add monetization hook
  shareText += " #CorporateEvil #ConsumerComplicity #SatiricalActivism";
  
  if (navigator.share) {
    navigator.share({
      title: `My Corporate Evil Support Score: ${score} points`,
      text: shareText,
      url: window.location.href
    }).then(() => {
      // Show monetization popup after successful share
      setTimeout(() => {
        if (confirm(`Thanks for sharing! 🎉\n\nSince you're spreading awareness about corporate evil, why not fund the fight against it?\n\nJoin our membership for just $5/month and get:\n• Weekly corporate evil exposés\n• Exclusive investigative reports\n• Early access to our satirical merchandise\n• The satisfaction of using capitalism to destroy capitalism\n\nJoin now?`)) {
          window.open('/membership/', '_blank');
        }
      }, 1000);
    });
  } else {
    // Fallback with enhanced monetization
    navigator.clipboard.writeText(shareText + ' ' + window.location.href).then(() => {
      alert(`Results copied to clipboard! 📋\n\n🎉 BONUS OFFER: Since you're sharing our satirical assessment, get 20% off your first month of membership with code EVIL20!\n\nOur membership includes:\n• Daily corporate malfeasance alerts\n• Exclusive investigative content\n• Members-only merchandise discounts\n• Direct access to our team of corporate evil researchers\n\nUse your power for good (or at least profitable activism)!`);
      
      // Offer direct membership signup
      if (confirm('Open membership page now?')) {
        window.open('/membership/?code=EVIL20', '_blank');
      }
    });
  }
}

function resetAssessment() {
  // Reset data
  assessmentData = {
    answers: {},
    totalScore: 0,
    corporateBeneficiaries: {},
    questionCount: {{ questions.size | default: 0 }}
  };
  
  // Reset form
  document.getElementById('assessment-form').reset();
  document.getElementById('results-container').style.display = 'none';
  document.querySelector('.calculate-evil').disabled = true;
  
  // Scroll to top
  document.getElementById('evil-assessment').scrollIntoView({ behavior: 'smooth' });
}
</script>