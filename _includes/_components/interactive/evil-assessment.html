---
# Consumer Evil Assessment Test Component
# Interactive quiz to help consumers maximize their support for corporate evil
---

{%- assign component = include.component -%}
{%- assign questions = component.questions | default: site.data.evil_assessment_questions -%}
{%- assign class = component.class | default: "" -%}
{%- assign title = component.title | default: "Consumer Evil Impact Assessment" -%}
{%- assign description = component.description | default: "Discover how to maximize the harm of your purchasing decisions. Because why support ethical companies when you can fund systematic oppression?" -%}

<div class="evil-assessment {{ class }}" id="evil-assessment">
  <div class="assessment-header">
    <h2>üî• {{ title }}</h2>
    <p class="assessment-description">{{ description }}</p>
  </div>

  <form class="assessment-form" id="assessment-form">
    <div class="questions-container" id="questions-container">
      {% for question in questions %}
      <div class="question-card" data-question="{{ forloop.index }}">
        <h3 class="question-title">
          <span class="question-number">{{ forloop.index }}.</span>
          {{ question.text }}
        </h3>
        
        <div class="options-container">
          {% for option in question.options %}
          <label class="option-label">
            <input type="radio" 
                   name="question-{{ forloop.parentloop.index }}" 
                   value="{{ option.evil_score }}"
                   data-corporate="{{ option.corporate_beneficiary | default: 'Various Corporations' }}"
                   class="option-input">
            <span class="option-text">{{ option.text }}</span>
            <span class="evil-indicator">üíÄ {{ option.evil_score }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="assessment-actions">
      <button type="button" 
              class="btn btn-primary calculate-evil" 
              onclick="calculateEvilScore()"
              disabled>
        Calculate Your Evil Impact üî•
      </button>
    </div>
  </form>

  <div class="results-container" id="results-container" style="display: none;">
    <div class="evil-score-display">
      <h3>üéØ Your Corporate Evil Support Score</h3>
      <div class="score-circle">
        <span class="score-number" id="total-score">0</span>
        <span class="score-label">Evil Points</span>
      </div>
      
      <div class="score-interpretation" id="score-interpretation">
        <!-- Dynamic content based on score -->
      </div>
    </div>

    <div class="impact-breakdown">
      <h4>üí∞ Corporate Beneficiaries</h4>
      <div class="beneficiaries-list" id="beneficiaries-list">
        <!-- Dynamic list of corporations you're helping -->
      </div>
    </div>

    <div class="evil-recommendations">
      <h4>üìà Maximize Your Evil Impact</h4>
      <div class="recommendations-list" id="recommendations-list">
        <!-- Dynamic recommendations -->
      </div>
    </div>

    <div class="share-results">
      <h4>üåê Spread the Evil</h4>
      <button class="btn btn-secondary" onclick="shareResults()">
        Share Your Evil Score
      </button>
      <button class="btn btn-primary" onclick="resetAssessment()">
        Take Assessment Again
      </button>
    </div>
  </div>
</div>

<script>
let assessmentData = {
  answers: {},
  totalScore: 0,
  corporateBeneficiaries: {},
  questionCount: {{ questions.size | default: 0 }}
};

// Enable calculate button when all questions are answered
function checkFormComplete() {
  const totalQuestions = assessmentData.questionCount;
  const answeredQuestions = Object.keys(assessmentData.answers).length;
  const calculateBtn = document.querySelector('.calculate-evil');
  
  if (answeredQuestions === totalQuestions) {
    calculateBtn.disabled = false;
  } else {
    calculateBtn.disabled = true;
  }
}

// Handle radio button changes
document.addEventListener('change', function(e) {
  if (e.target.matches('.option-input')) {
    const questionNum = e.target.name.split('-')[1];
    const evilScore = parseInt(e.target.value);
    const corporate = e.target.dataset.corporate;
    
    // Store answer
    assessmentData.answers[questionNum] = {
      score: evilScore,
      corporate: corporate
    };
    
    // Update corporate beneficiaries count
    if (assessmentData.corporateBeneficiaries[corporate]) {
      assessmentData.corporateBeneficiaries[corporate] += evilScore;
    } else {
      assessmentData.corporateBeneficiaries[corporate] = evilScore;
    }
    
    checkFormComplete();
  }
});

function calculateEvilScore() {
  // Calculate total score
  let totalScore = 0;
  Object.values(assessmentData.answers).forEach(answer => {
    totalScore += answer.score;
  });
  
  assessmentData.totalScore = totalScore;
  
  // Show results
  document.getElementById('results-container').style.display = 'block';
  document.getElementById('total-score').textContent = totalScore;
  
  // Generate interpretation
  displayScoreInterpretation(totalScore);
  
  // Display corporate beneficiaries
  displayCorporateBeneficiaries();
  
  // Generate recommendations
  generateRecommendations(totalScore);
  
  // Scroll to results
  document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
}

function displayScoreInterpretation(score) {
  const interpretationEl = document.getElementById('score-interpretation');
  let interpretation = '';
  
  if (score >= 80) {
    interpretation = `
      <div class="score-level master-evil">
        <h5>üèÜ Master of Corporate Evil</h5>
        <p>Congratulations! You're a true corporate enabler. Your purchasing decisions maximize shareholder value while minimizing human welfare. The 1% salutes your dedication to systematic oppression.</p>
      </div>
    `;
  } else if (score >= 60) {
    interpretation = `
      <div class="score-level experienced-evil">
        <h5>üíº Experienced Evil Enabler</h5>
        <p>Impressive! You've mastered the art of supporting corporate malfeasance. With a few tweaks, you could achieve true evil mastery. Consider upgrading to premium exploitation packages.</p>
      </div>
    `;
  } else if (score >= 40) {
    interpretation = `
      <div class="score-level moderate-evil">
        <h5>üìä Moderate Evil Contributor</h5>
        <p>You're on the right track to supporting corporate domination, but there's room for improvement. Consider embracing more destructive consumer choices for maximum societal harm.</p>
      </div>
    `;
  } else if (score >= 20) {
    interpretation = `
      <div class="score-level amateur-evil">
        <h5>üå± Amateur Evil Supporter</h5>
        <p>You show promise in supporting corporate evil, but you're still too concerned with ethics. Embrace the dark side of capitalism - your wallet and the oligarchy will thank you.</p>
      </div>
    `;
  } else {
    interpretation = `
      <div class="score-level ethical-failure">
        <h5>üòá Ethical Failure</h5>
        <p>Oh no! You're practically a humanitarian. Your consumer choices actually support workers, communities, and the environment. This is highly inefficient for corporate profit extraction.</p>
      </div>
    `;
  }
  
  interpretationEl.innerHTML = interpretation;
}

function displayCorporateBeneficiaries() {
  const beneficiariesEl = document.getElementById('beneficiaries-list');
  const sorted = Object.entries(assessmentData.corporateBeneficiaries)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);
  
  let html = '<div class="beneficiaries-grid">';
  sorted.forEach(([company, score]) => {
    html += `
      <div class="beneficiary-item">
        <span class="company-name">${company}</span>
        <span class="evil-contribution">+${score} evil points</span>
      </div>
    `;
  });
  html += '</div>';
  
  beneficiariesEl.innerHTML = html;
}

function generateRecommendations(score) {
  const recommendationsEl = document.getElementById('recommendations-list');
  const recommendations = [
    "Shop exclusively at monopolistic retailers to crush small businesses",
    "Choose fast fashion to maximize worker exploitation and environmental damage",
    "Invest in fossil fuel companies for maximum climate destruction",
    "Support companies with the worst labor practices for premium oppression",
    "Buy from corporations with extensive tax avoidance schemes",
    "Choose products with the highest carbon footprint available",
    "Support companies that lobby against consumer protection laws",
    "Prioritize brands that use child labor in their supply chains"
  ];
  
  // Randomly select 3-4 recommendations
  const selected = recommendations.sort(() => 0.5 - Math.random()).slice(0, 4);
  
  let html = '<ul class="recommendations-list">';
  selected.forEach(rec => {
    html += `<li class="recommendation-item">üí° ${rec}</li>`;
  });
  html += '</ul>';
  
  recommendationsEl.innerHTML = html;
}

function shareResults() {
  const score = assessmentData.totalScore;
  const text = `I scored ${score} evil points on the Corporate Evil Support Assessment! Discover how your consumer choices fuel systematic oppression.`;
  
  if (navigator.share) {
    navigator.share({
      title: 'My Corporate Evil Support Score',
      text: text,
      url: window.location.href
    });
  } else {
    // Fallback - copy to clipboard
    navigator.clipboard.writeText(text + ' ' + window.location.href);
    alert('Results copied to clipboard!');
  }
}

function resetAssessment() {
  // Reset data
  assessmentData = {
    answers: {},
    totalScore: 0,
    corporateBeneficiaries: {},
    questionCount: {{ questions.size | default: 0 }}
  };
  
  // Reset form
  document.getElementById('assessment-form').reset();
  document.getElementById('results-container').style.display = 'none';
  document.querySelector('.calculate-evil').disabled = true;
  
  // Scroll to top
  document.getElementById('evil-assessment').scrollIntoView({ behavior: 'smooth' });
}
</script>